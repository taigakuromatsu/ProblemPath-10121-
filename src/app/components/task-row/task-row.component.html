<div class="task-row" [class.dense]="dense" [class.done]="task.status === 'done'">
  <!-- 左のステータス丸 -->
  <div class="status-dot" [style.background]="statusColor(task.status)"></div>

  <!-- 中央コンテンツ -->
  <div class="task-content">
    <!-- タイトル行 -->
    <div class="task-title">
      <span class="title-text">{{ task.title }}</span>
      <span *ngIf="priorityLabel(task) as p" class="priority">[{{ p }}]</span>
    </div>

    <!-- メタ情報行 -->
    <div class="task-meta">
      <!-- 期日バッジ -->
      <span class="due" [ngClass]="['badge', dueBadge(task)]">
        {{ dueLabel(task) }}
      </span>

      <!-- 担当者 -->
      <span class="assignees" [matTooltip]="assignees(task)">
        <mat-icon>group</mat-icon>
        <span>{{ assignees(task) }}</span>
      </span>

      <!-- タグ数（0のときは非表示） -->
      <span class="metric" *ngIf="tagsCount(task) > 0">
        <mat-icon>sell</mat-icon>
        <span>{{ tagsCount(task) }}</span>
      </span>

      <!-- コメント数 -->
      <span class="metric">
        <mat-icon>forum</mat-icon>
        <span>{{ commentCount(task) }}</span>
      </span>

      <!-- 添付ファイル数 -->
      <span class="metric">
        <mat-icon>attach_file</mat-icon>
        <span>{{ attachmentCount(task) }}</span>
      </span>
    </div>
  </div>

  <div class="actions" *ngIf="actions">
    <!-- 完了 -->
    <button
      class="action-complete"
      *ngIf="actions.complete !== false"
      mat-icon-button
      [matTooltip]="'schedule.actions.complete' | translate"
      [attr.aria-label]="'schedule.actions.complete' | translate"
      (click)="onComplete()">
      <mat-icon>check_circle</mat-icon>
    </button>

    <!-- −1日 -->
    <button
      *ngIf="actions.shift !== false"
      mat-icon-button
      [matTooltip]="'schedule.actions.minusOne' | translate"
      [attr.aria-label]="'schedule.actions.minusOne' | translate"
      [disabled]="busy || !task.dueDate"
      (click)="onShift(-1)">
      <mat-icon>arrow_back</mat-icon>
    </button>

    <!-- ＋1日 -->
    <button
      *ngIf="actions.shift !== false"
      mat-icon-button
      [matTooltip]="'schedule.actions.plusOne' | translate"
      [attr.aria-label]="'schedule.actions.plusOne' | translate"
      [disabled]="busy || !task.dueDate"
      (click)="onShift(1)">
      <mat-icon>arrow_forward</mat-icon>
    </button>

    <!-- 今日にする -->
    <button
      *ngIf="actions.setToday !== false"
      mat-icon-button
      [matTooltip]="'schedule.actions.today' | translate"
      [attr.aria-label]="'schedule.actions.today' | translate"
      [disabled]="busy"
      (click)="onSetToday()">
      <mat-icon>today</mat-icon>
    </button>

    <!-- ボードを開く（クエリは既存仕様を踏襲） -->
    <a
      *ngIf="task.problemId && task.issueId"
      mat-icon-button
      [routerLink]="['/board']"
      [queryParams]="{ pid: task.problemId }"
      [matTooltip]="'schedule.openInBoard' | translate"
      [attr.aria-label]="'schedule.openInBoard' | translate">
      <mat-icon>open_in_new</mat-icon>
    </a>
  </div>
</div>





