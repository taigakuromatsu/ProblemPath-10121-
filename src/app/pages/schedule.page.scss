.schedule-page{
  display:flex; flex-direction:column;
  gap:calc(var(--gap-4) + 12px * var(--m));
  padding:var(--pad-2);
  font-size:var(--fs-b); line-height:1.5; min-width:0;
}

/* ── ヘッダー共通 ─────────────────────────── */
.page-header{ display:flex; flex-direction:column; gap:var(--gap-3); }
.headline{ display:flex; justify-content:space-between; align-items:center; gap:var(--gap-3); flex-wrap:wrap; }
.headline > *{ min-width:0; }
.headline h1{ margin:0; font-size:var(--fs-t); line-height:1.3; }
.headline .muted{ margin-top:calc(4px * var(--m)); }
.view-toggle{ display:inline-flex; align-items:center; border-radius:999px; min-width:0; }

/* ── ヘッダー上段レイアウト ─────────────────── */
/* 1:Export / 2:Spacer / 3:表示 / 4:右フィルタ（ここにレンジ/タグ/担当者） */
.header-grid{
  --header-mid-gap: clamp(24px, 4vw, 64px);
  display:grid;
  grid-template-columns: max-content var(--header-mid-gap) max-content 1fr;
  column-gap: clamp(20px, 3vw, 40px);
  row-gap: var(--gap-3);
  align-items:start;
  min-width:0;
}
.export-card{ grid-column:1; }
.center-controls{ grid-column:3; justify-self:start; min-width:0; }
.right-filters{ grid-column:4; }

/* Export ボックス */
.export-card{
  display:flex; flex-direction:column; gap:var(--gap-2);
  padding:clamp(16px, 2vw, 20px);
  border:1px solid var(--divider); border-radius:var(--radius);
  background:linear-gradient(135deg, color-mix(in srgb, var(--accent-blue) 4%, var(--surface)) 0%, var(--surface) 100%);
  box-shadow:0 2px 8px rgba(0,0,0,0.04), 0 0 0 1px color-mix(in srgb, var(--accent-blue) 8%, transparent);
  width:max-content;
  min-width:clamp(180px, 18vw, 240px);
  transition:box-shadow 0.2s ease, transform 0.2s ease;
}
.export-card:hover{
  box-shadow:0 4px 12px rgba(0,0,0,0.06), 0 0 0 1px color-mix(in srgb, var(--accent-blue) 12%, transparent);
  transform:translateY(-1px);
}
.export-card .group-title{
  display:flex; align-items:center; gap:var(--gap-1);
  font-weight:600; font-size:var(--fs-b);
  color:var(--accent-blue);
  white-space:nowrap;
}
.export-card .group-title mat-icon{
  font-size:20px; width:20px; height:20px;
  color:var(--accent-blue);
}
.export-card .group-actions{
  display:flex; gap:var(--gap-2);
  flex-wrap:wrap;
}
.export-card .group-actions button{
  flex:1 1 auto;
  min-width:80px;
  transition:all 0.2s ease;
}
.export-card .group-actions button:hover{
  background:color-mix(in srgb, var(--accent-blue) 8%, var(--surface));
  border-color:var(--accent-blue);
}

/* 表示（中央） */
.center-controls{
  display:flex; flex-direction:column; gap:var(--gap-2);
  padding:clamp(16px, 2vw, 20px);
  border:1px solid var(--divider); border-radius:var(--radius);
  background:linear-gradient(135deg, color-mix(in srgb, var(--muted) 3%, var(--surface)) 0%, var(--surface) 100%);
  box-shadow:0 2px 8px rgba(0,0,0,0.04);
  text-align:left; overflow:hidden;
  min-width:clamp(200px, 20vw, 280px);
  transition:box-shadow 0.2s ease, transform 0.2s ease;
}
.center-controls:hover{
  box-shadow:0 4px 12px rgba(0,0,0,0.06);
  transform:translateY(-1px);
}
.center-controls .control-label{
  font-weight:600; font-size:var(--fs-b);
  color:var(--text);
  margin-bottom:4px;
}
.center-controls .mat-button-toggle-group,
.center-controls mat-button-toggle-group{
  max-width:100%; display:flex; flex-wrap:wrap;
  border-radius:var(--radius);
  overflow:hidden;
}
.center-controls .mat-button-toggle-group mat-button-toggle,
.center-controls mat-button-toggle-group mat-button-toggle{
  flex:1 1 auto;
  min-width:0;
}
.center-controls .mat-button-toggle-group mat-button-toggle ::ng-deep button,
.center-controls mat-button-toggle-group mat-button-toggle ::ng-deep button{
  width:100%;
  min-height:100%;
  pointer-events:auto;
}
.center-controls .mat-button-toggle-group mat-button-toggle ::ng-deep .mat-button-toggle-label-content,
.center-controls mat-button-toggle-group mat-button-toggle ::ng-deep .mat-button-toggle-label-content{
  pointer-events:none;
}

/* 右：レンジ + タグ + 担当者 */
.right-filters{
  display:flex; align-items:start; justify-content:flex-end;
  gap: clamp(16px, 2vw, 32px);
  flex-wrap:wrap; min-width:0;
  padding:clamp(16px, 2vw, 20px);
  border:1px solid var(--divider); border-radius:var(--radius);
  background:linear-gradient(135deg, color-mix(in srgb, var(--accent-blue) 2%, var(--surface)) 0%, var(--surface) 100%);
  box-shadow:0 2px 8px rgba(0,0,0,0.04);
  transition:box-shadow 0.2s ease;
}
.right-filters:hover{
  box-shadow:0 4px 12px rgba(0,0,0,0.06);
}
.filter-group{
  display:flex; flex-direction:column; gap:var(--gap-1);
  min-width:0;
}
.filter-group label{
  font-weight:600; font-size:var(--fs-b);
  color:var(--text);
  margin-bottom:2px;
}

/* ▼ 追加：日付レンジ（2フィールド横並び） */
.filter-group.range{
  display:flex; flex-direction:column; gap:var(--gap-1);
  min-width:0;
}
.filter-group.range .range-label{
  font-weight:600; font-size:var(--fs-b);
  color:var(--text);
  margin-bottom:2px;
}
.filter-group.range .range-fields{
  display:flex; flex-direction:row; gap:var(--gap-2);
  align-items:flex-end;
  flex-wrap:wrap;
}
.filter-group.range .date-field{
  width:clamp(160px, 12vw, 220px);
  flex:1 1 auto;
  min-width:160px;
}
.filter-group.range .date-field ::ng-deep .mat-form-field-wrapper{
  padding-bottom:0;
}

/* タグは .tags クラスで幅を指定（:first-child 依存を廃止） */
.filter-group.tags{
  flex:0 1 auto;
  min-width:clamp(180px, 18vw, 280px);
  max-width:clamp(220px, 22vw, 320px);
}
.filter-group.tags input{
  padding:calc(10px * var(--m)) calc(14px * var(--m));
  border-radius:var(--radius);
  border:1px solid var(--border);
  background:var(--surface);
  color:inherit;
  min-width:0;
  font-size:var(--fs-b);
  line-height:1.4;
  width:100%;
  transition:border-color 0.2s ease, box-shadow 0.2s ease;
}
.filter-group.tags input:focus{
  outline:none;
  border-color:var(--accent-blue);
  box-shadow:0 0 0 3px color-mix(in srgb, var(--accent-blue) 12%, transparent);
}

/* 担当者 */
.right-filters .assignees{
  flex:0 1 auto;
  min-width:clamp(180px, 16vw, 260px);
  max-width:clamp(200px, 20vw, 300px);
}
.right-filters .assignees mat-select{
  width:100%;
  min-width:0;
}
.right-filters .assignees ::ng-deep .mat-form-field-wrapper{
  padding-bottom:0;
}

/* ── ラップトップ幅：2段に分けて重なり回避 ───────── */
@media (max-width: 1400px){
  .header-grid{
    grid-template-columns: 1fr 1fr;
    grid-auto-rows: minmax(0, auto);
    column-gap: var(--gap-3);
    row-gap: var(--gap-3);
    --header-mid-gap: 0;
  }
  .export-card{
    grid-column:1; grid-row:1;
    justify-self:start;
    width:100%;
    max-width:100%;
  }
  .center-controls{
    grid-column:2; grid-row:1;
    justify-self:end;
    max-width:100%;
    width:100%;
  }
  .right-filters{
    grid-column:1 / -1; grid-row:2;
    justify-content:flex-start;
    flex-wrap:wrap;
    gap:clamp(16px, 2.5vw, 24px);
    width:100%;
  }
  .filter-group.range{
    flex:1 1 100%;
    max-width:100%;
  }
  .filter-group.range .date-field{
    width:clamp(160px, 45%, 220px);
    flex:1 1 auto;
  }
  .filter-group.tags{
    flex:1 1 auto;
    min-width:clamp(180px, 30%, 280px);
    max-width:100%;
  }
  .right-filters .assignees{
    flex:1 1 auto;
    min-width:clamp(180px, 30%, 260px);
    max-width:100%;
  }
}

/* ── タブレット以下：縦積み ─────────────────── */
@media (max-width: 960px){
  .header-grid{
    grid-template-columns:1fr;
    column-gap:0;
    row-gap:var(--gap-3);
    --header-mid-gap:0;
  }
  .export-card,
  .center-controls,
  .right-filters{
    grid-column:auto;
    grid-row:auto;
    justify-self:stretch;
    width:100%;
    max-width:100%;
  }
  .export-card{ min-width:auto; }
  .center-controls{ min-width:auto; }
  .right-filters{
    justify-content:flex-start;
    flex-wrap:wrap;
    gap:var(--gap-3);
  }
  .filter-group.range{
    flex:1 1 100%;
    width:100%;
  }
  .filter-group.range .date-field{
    width:100%;
    flex:1 1 100%;
  }
  .filter-group.tags,
  .right-filters .assignees{
    flex:1 1 100%;
    width:100%;
    min-width:auto;
    max-width:100%;
  }
  .filter-group.tags input{
    width:100%;
  }
}

/* ── リスト側（既存） ─────────────────────── */
.view-container{ display:block; min-width:0; }
.list-grid{ display:grid; gap:var(--gap-4); grid-template-columns:repeat(auto-fit, minmax(calc(320px * var(--m)), 1fr)); min-width:0; }
mat-card{ display:flex; flex-direction:column; gap:var(--gap-2); padding:var(--pad-2); border-radius:var(--radius); background:var(--surface); box-shadow:var(--shadow, 0 2px 8px rgba(0,0,0,0.03)); }
mat-card.empty{ opacity:.65; }
mat-card header{ display:flex; align-items:flex-start; gap:var(--gap-2); }
mat-card header > *{ min-width:0; }
mat-card header h2{ margin:0; font-size:var(--fs-t); line-height:1.3; font-weight:600; }
.icon {
  width: calc(40px * var(--m));
  height: calc(40px * var(--m));
  border-radius: var(--radius);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  font-size: var(--fs-t);
  line-height: 1;
}
.icon.danger{ background:color-mix(in srgb, var(--accent-red) 18%, transparent); color:var(--accent-red); }
.icon.info{ background:color-mix(in srgb, var(--accent-blue) 18%, transparent); color:var(--accent-blue); }
.count-badge{ margin-top:var(--gap-1); font-size:var(--fs-b); font-weight:600; color:var(--muted); }
.section-body{ display:flex; flex-direction:column; gap:var(--gap-2); min-width:0; }
.empty{ padding:var(--pad-1); border-radius:var(--radius); border:1px dashed var(--divider); color:var(--muted); text-align:center; font-size:var(--fs-b); line-height:1.4; }

/* ヘッダーとリスト間の余白＆スクロール抑止 */
.schedule-page > .page-header{ margin-bottom:clamp(24px, 3.5vh, 56px); }
.page-header.card{ overflow:visible; max-height:none; -ms-overflow-style:none; scrollbar-width:none; }
.page-header.card::-webkit-scrollbar{ display:none; }

.list-grid {
  position: relative;
}

/* 期限切れにタスクがあるときだけ sticky 強調 */
mat-card.section--overdue:not(.empty) {
  position: sticky;
  top: 0;
  z-index: 20;
  background: var(--due-overdue-bg);
  box-shadow:
    0 4px 14px rgba(0, 0, 0, 0.18),
    0 0 0 1px color-mix(in srgb, var(--accent-red) 28%, transparent);
  border-radius: var(--radius);
}

/* 空なら通常表示（カード一覧が暴れないように） */
mat-card.section--overdue.empty {
  position: static;
  box-shadow: var(--shadow, 0 2px 8px rgba(0,0,0,0.03));
  background: var(--surface);
}

/* 期限切れ：赤＋強め */
.section--overdue .icon {
  background: var(--due-overdue-bg);
  color: var(--due-overdue-fg);
}
.section--overdue h2,
.section--overdue .count-badge {
  color: var(--due-overdue-fg);
}

/* 当日：オレンジ */
.section--today .icon {
  background: var(--due-today-bg);
  color: var(--due-today-fg);
}
.section--today h2,
.section--today .count-badge {
  color: var(--due-today-fg);
}

/* 期限近い（明日＋今週残り）：黄 */
.section--tomorrow .icon,
.section--thisWeekRest .icon {
  background: var(--due-near-bg);
  color: var(--due-near-fg);
}
.section--tomorrow h2,
.section--thisWeekRest h2,
.section--tomorrow .count-badge,
.section--thisWeekRest .count-badge {
  color: var(--due-near-fg);
}

/* 来週以降：青 */
.section--nextWeek .icon,
.section--later .icon {
  background: var(--due-later-bg);
  color: var(--due-later-fg);
}
.section--nextWeek h2,
.section--later h2,
.section--nextWeek .count-badge,
.section--later .count-badge {
  color: var(--due-later-fg);
}

/* 期限なし：控えめ */
.section--nodue .icon {
  background: var(--due-nodue-bg);
  color: var(--due-nodue-fg);
}
.section--nodue h2,
.section--nodue .count-badge {
  color: var(--due-nodue-fg);
}

/* 期限ステータス共通カラー */
.schedule-page,
.my-page {
  /* 期限切れ（赤） */
  --due-overdue-fg: var(--accent-red);
  --due-overdue-bg: color-mix(in srgb, var(--accent-red) 14%, var(--surface));

  /* 当日（オレンジ） */
  --due-today-fg: #e65100;
  --due-today-bg: color-mix(in srgb, #ff9800 14%, var(--surface));

  /* 期限近い（明日＋今週残り：黄） */
  --due-near-fg: #ff8f00;
  --due-near-bg: color-mix(in srgb, #ffc107 16%, var(--surface));

  /* 来週以降（青） */
  --due-later-fg: var(--accent-blue);
  --due-later-bg: color-mix(in srgb, var(--accent-blue) 12%, var(--surface));

  /* 期限なし（控えめグレー） */
  --due-nodue-fg: var(--muted);
  --due-nodue-bg: color-mix(in srgb, var(--muted) 8%, var(--surface));
}