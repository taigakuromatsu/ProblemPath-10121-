@use '@angular/material' as mat;

html {
  @include mat.theme((
    color: ( theme-type: light, primary: mat.$azure-palette, tertiary: mat.$blue-palette ),
    typography: Roboto, density: 0,
  ));
}
html.dark {
  @include mat.theme((
    color: ( theme-type: dark, primary: mat.$azure-palette, tertiary: mat.$blue-palette ),
    typography: Roboto, density: 0,
  ));
}

/* --------------------------------
   2) Design Tokens
-----------------------------------*/
:root {
  --scale: clamp(0.85, calc(100vw / 1440), 1);
  --density: 0.64;
  --m: calc(var(--scale) * var(--density));

  /* Space & Size */
  --radius: calc(12px * var(--m));
  --gap-1: calc(6px * var(--m));
  --gap-2: calc(10px * var(--m));
  --gap-3: calc(14px * var(--m));
  --gap-4: calc(18px * var(--m));
  --gap-5: calc(24px * var(--m));
  --pad-1: var(--gap-2);
  --pad-2: var(--gap-4);
  --pad-3: calc(28px * var(--m));
  --icon: calc(20px * var(--m));
  --fs-t: clamp(16px, calc(16px * var(--m)), 20px);
  --fs-b: clamp(13px, calc(14px * var(--m)), 16px);

  /* Layout */
  --card-w: calc(340px * var(--m));
  --sidebar-base: 200px;
  --sidebar: clamp(182px, 17vw, 224px);
  --topbar-h: clamp(52px, calc(52px * var(--m)), 64px);

  /* Palette */
  --bg: #f5f6f8;
  --surface: #ffffff;
  --surface-subtle: #f1f3f6;
  --fg: #111111;
  --muted: #6b7280;
  --border: rgba(17, 24, 39, 0.08);
  --divider: rgba(17, 24, 39, 0.1);
  --shadow: 0 6px 20px rgba(15, 23, 42, 0.08);
  --accent-blue: #2f6feb;
  --accent-green: #23a559;
  --accent-red: #e23d3d;
}

:root.dark {
  --bg: #1c1d20;
  --surface: #2a2d33;
  --surface-subtle: #22242a;
  --fg: #e6eaf0;
  --muted: #9da5b4;
  --border: rgba(230, 234, 240, 0.14);
  --divider: rgba(230, 234, 240, 0.1);
  --shadow: 0 10px 24px rgba(2, 6, 23, 0.45);
  --accent-blue: #60a5fa;
  --accent-green: #34d399;
  --accent-red: #f87171;
  color-scheme: dark;
}

/* --------------------------------
   8) Layout Shell (Topbar + Sidebar)
-----------------------------------*/

*,
*::before,
*::after { box-sizing: border-box; }

/* ページ全体はみ出し禁止（本体で横スクロールを出さない） */
html, body { 
  width: 100%; 
  max-width: 100vw; 
  overflow-x: hidden; 
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

.shell {
  height: 100vh;
  background: var(--bg);
  width: 100%;
  max-width: 100vw;
  overflow-x: hidden;
  box-sizing: border-box;
}

.shell__sidenav {
  width: min(var(--sidebar), 90vw);
  flex: 0 0 min(var(--sidebar), 90vw);
  border-right: 1px solid rgba(255, 255, 255, 0.08);
  background: #000000;
  color: #f5f7fb;
  padding: calc(20px * var(--m)) calc(16px * var(--m));
  display: flex;
  flex-direction: column;
  gap: var(--gap-2);
  box-shadow: inset -1px 0 0 rgba(255, 255, 255, 0.04);
}

.sidenav__wrapper { display: flex; flex-direction: column; gap: var(--gap-2); height: 100%; }

.sidenav__header {
  display: flex;
  align-items: center;
  min-height: calc(32px * var(--m));
  padding-inline: calc(4px * var(--m));
}
.sidenav__brand {
  font-size: clamp(15px, calc(16px * var(--m)), 18px);
  font-weight: 700;
  letter-spacing: 0.16em;
  text-transform: uppercase;
}

.shell__content {
  background: var(--bg);
  color: var(--fg);
  min-width: 0;
  display: flex;
  flex-direction: column;
  height: 100%;
  width: 100%;
  max-width: calc(100vw - var(--sidebar));
  overflow-x: hidden;
  box-sizing: border-box;
}

/* --- Angular Material のコンテナ側でも横はみ出し禁止 --- */
.mat-sidenav-container {
  width: 100%;
  max-width: 100vw;
  overflow-x: hidden;
  box-sizing: border-box;
  position: relative;
}

/* --------------------------------
   Topbar（タブの押し広げ対策）
-----------------------------------*/
.topbar {
  position: sticky;
  top: 0;
  z-index: 1000;
  display: flex;
  align-items: center;
  flex-wrap: wrap;                 /* ここで折り返し許可 */
  gap: clamp(12px, 2vw, 24px);
  height: var(--topbar-h);
  padding-inline: clamp(16px, 4vw, 32px);
  box-shadow: 0 1px 0 rgba(15, 23, 42, 0.08);
  max-width: 100%;
  box-sizing: border-box;
}
.mat-toolbar.topbar.mat-primary {
  background: var(--surface);
  color: var(--fg);
}

.topbar .menu-button { color: inherit; }

.brand {
  display: flex;
  align-items: center;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.16em;
  min-width: 0;
  font-size: clamp(14px, calc(15px * var(--m)), 18px);
}
.brand__title { white-space: nowrap; }

/* タブ列は縮む・折り返す・必要なら自身だけ横スクロール */
.topnav {
  display: flex;
  align-items: center;
  gap: calc(10px * var(--m));
  flex: 1 1 auto;                 /* 余白はここで吸収 */
  min-width: 0;                   /* 押し広げ防止 */
  flex-wrap: wrap;                /* まず折り返し */
  overflow-x: auto;               /* それでも溢れたらタブだけ横スクロール */
  white-space: nowrap;
}

.topnav .tab-btn {
  border-radius: 999px !important;
  border: 1px solid var(--border) !important;
  padding: 0 clamp(16px, 2vw, 24px) !important;
  height: clamp(30px, calc(32px * var(--m)), 36px) !important;
  min-height: clamp(30px, calc(32px * var(--m)), 36px) !important;
  line-height: 1 !important;
  min-width: 0 !important;
  backdrop-filter: blur(6px);
  transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
}
.topnav .tab-btn:hover {
  background: color-mix(in srgb, var(--accent-blue) 6%, #ffffff 94%);
}
.topnav .tab-btn.active {
  background: color-mix(in srgb, var(--accent-blue) 12%, #ffffff 88%);
  border-color: color-mix(in srgb, var(--accent-blue) 40%, transparent) !important;
  box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--accent-blue) 32%, transparent);
}

/* 右上アクションは固定幅にせず縮む余地を残す */
.topbar .spacer { flex: 0 0 clamp(16px, 4vw, 64px); }
.topbar-actions {
  display: flex; 
  align-items: center; 
  gap: calc(6px * var(--m));
  flex: 0 0 auto; 
  min-width: 0; 
  max-width: 100%;
  margin-left: auto;
  flex-wrap: wrap;
}

.auth-button.auth--compact {
  border-radius: 999px !important;
  font-size: calc(9px * var(--m));
  height: calc(18px * var(--m)) !important;
  min-height: calc(18px * var(--m)) !important;
  padding: 0 calc(6px * var(--m)) !important;
  --mdc-outlined-button-outline-width: 1px;
  min-width: 0;
  max-width: 100%;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.user-chip.user-chip--compact {
  display: inline-flex; align-items: center;
  height: calc(18px * var(--m)); padding: 0 calc(6px * var(--m));
  border-radius: 999px; background: color-mix(in srgb, var(--accent-blue) 12%, transparent);
  font-size: calc(9px * var(--m)); 
  min-width: 0;
  max-width: 100%;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* コンテンツ領域は常に100%幅・はみ出し禁止 */
.content-area {
  flex: 1 1 auto;
  width: 100%;
  min-width: 0;
  min-height: calc(100vh - var(--topbar-h));
  padding: clamp(16px, 3vw, 28px);
  background: var(--bg);
  overflow-x: hidden;
}

/* 狭幅時の最終保険 */
@media (max-width: 959px) {
  .content-area { padding: clamp(12px, 4vw, 20px); }
  .topbar .spacer { flex-basis: 12px; }
}

/* --- Sidenav 幅とコンテンツの押し出し幅を同期（MatSidenav/MatDrawer 両対応） --- */
.shell__sidenav.mat-drawer,
.shell__sidenav.mat-sidenav,
.mat-drawer.shell__sidenav,
.mat-sidenav.shell__sidenav {
  width: var(--sidebar) !important;
  flex: 0 0 var(--sidebar) !important;
}
.shell__sidenav .mat-drawer-inner-container { width: 100% !important; }

.shell .mat-sidenav-container { 
  --pp-sidenav-w: min(var(--sidebar), 90vw); 
  width: 100%;
  max-width: 100vw;
  box-sizing: border-box;
}
.shell :where(.mat-sidenav, .mat-drawer) {
  width: var(--pp-sidenav-w) !important;
  flex: 0 0 var(--pp-sidenav-w) !important;
  max-width: var(--pp-sidenav-w) !important;
  box-sizing: border-box;
}
.shell :where(.mat-drawer-content, .mat-sidenav-content, .shell__content) {
  min-width: 0;
  overflow-x: hidden;
  box-sizing: border-box;
  /* サイドバーの幅を引いた残りの幅にする */
  width: calc(100vw - var(--sidebar)) !important;
  max-width: calc(100vw - var(--sidebar)) !important;
}
.shell :where(.mat-drawer-content, .mat-sidenav-content) > * { 
  min-width: 0;
  max-width: 100%;
}

/* タブや見出しが原因のはみ出し予防（最小幅を潰せるように） */
.topbar, .topnav, .brand, .topbar-actions { min-width: 0; }

/* --- 左サイドを黒（Jooto風）に --- */
.sidenav--dark {
  background: #0f141a !important;
  color: #e6eaf0 !important;
  border-right: 1px solid rgba(230,234,240,0.12) !important;
}

/* プロジェクトボタンを暗色で押しやすく */
.sidenav--dark .switcher__item {
  background: #151b22 !important;
  color: #e6eaf0 !important;
  border: 1px solid rgba(230,234,240,0.08) !important;
  min-height: 40px;
}
.sidenav--dark .switcher__item:hover { background: #1b222b !important; }
.sidenav--dark .switcher__item.is-active {
  background: #1e2630 !important;
  box-shadow: inset 0 0 0 1px #6da3ff !important;
}

/* ===== HOTFIX: 右端が見切れる問題を解消（サイドバー+コンテンツの合計幅対策） ===== */

/* 横スクロールを出さずに収めたいのは"本文領域"だけ */
.content-area {
  overflow-x: hidden;    /* ボディ側ではなくここで隠す */
}

/* タブ列・右上アクションが押し広げないよう再度ガード */
.topbar, .topnav, .brand, .topbar-actions {
  min-width: 0;
  max-width: 100%;
}
.topnav {
  flex: 1 1 auto;
  min-width: 0;
  flex-wrap: wrap;       /* 折り返し可 */
  overflow-x: auto;      /* それでも溢れる場合はタブだけ横スクロール */
}

/* モバイル時（overlayモード）ではコンテンツは100% */
@media (max-width: 959px) {
  .shell :where(.mat-drawer-content, .mat-sidenav-content, .shell__content) {
    width: 100vw !important;
    max-width: 100vw !important;
  }
}

/* コンテンツ内のすべての要素がはみ出さないように */
.content-area > * {
  max-width: 100%;
  min-width: 0;
  box-sizing: border-box;
}

/* すべてのカードやセクションが確実に収まるように */
.section-card,
.card,
mat-card {
  max-width: 100%;
  min-width: 0;
  box-sizing: border-box;
  overflow-x: hidden;
}

/* ボタンやフォーム要素も確実に収まるように */
button,
input,
select,
textarea {
  max-width: 100%;
  box-sizing: border-box;
}


