/* ======（前半はそのまま）====== */
@use '@angular/material' as mat;

html {
  @include mat.theme((
    color: ( theme-type: light, primary: mat.$azure-palette, tertiary: mat.$blue-palette ),
    typography: Roboto, density: 0,
  ));
}
html.dark {
  @include mat.theme((
    color: ( theme-type: dark, primary: mat.$azure-palette, tertiary: mat.$blue-palette ),
    typography: Roboto, density: 0,
  ));
}

/* ---------------------------
   2) Design Tokens
   --------------------------- */
:root {
  --scale: clamp(0.85, calc(100vw / 1440), 1);
  --density: 0.64;
  --m: calc(var(--scale) * var(--density));

  /* Space & Size */
  --radius: calc(12px * var(--m));
  --gap-1: calc(6px * var(--m));
  --gap-2: calc(10px * var(--m));
  --gap-3: calc(14px * var(--m));
  --gap-4: calc(18px * var(--m));
  --gap-5: calc(24px * var(--m));
  --pad-1: var(--gap-2);
  --pad-2: var(--gap-4);
  --pad-3: calc(28px * var(--m));
  --icon: calc(20px * var(--m));
  --fs-t: clamp(16px, calc(16px * var(--m)), 20px);
  --fs-b: clamp(13px, calc(14px * var(--m)), 16px);

  /* Layout */
  --card-w: calc(340px * var(--m));
  --sidebar-base: 200px;
  --sidebar: clamp(182px, 17vw, 224px);
  --topbar-h: clamp(52px, calc(52px * var(--m)), 64px);

  /* Palette */
  --bg: #f5f6f8;
  --surface: #ffffff;
  --surface-subtle: #f1f3f6;
  --fg: #111111;
  --muted: #6b7280;
  --border: rgba(17, 24, 39, 0.08);
  --divider: rgba(17, 24, 39, 0.1);
  --shadow: 0 6px 20px rgba(15, 23, 42, 0.08);
  --accent-blue: #2f6feb;
  --accent-green: #23a559;
  --accent-red: #e23d3d;
}

:root.dark {
  --bg: #1c1d20;
  --surface: #2a2d33;
  --surface-subtle: #22242a;
  --fg: #e6eaf0;
  --muted: #9da5b4;
  --border: rgba(230, 234, 240, 0.14);
  --divider: rgba(230, 234, 240, 0.1);
  --shadow: 0 10px 24px rgba(2, 6, 23, 0.45);
  --accent-blue: #60a5fa;
  --accent-green: #34d399;
  --accent-red: #f87171;
  color-scheme: dark;
}

/* ======（Base〜Utilities は現行のまま。以下、共通UIの変更点を中心に差分）====== */

/* ---------------------------
   8) Layout Shell (Topbar + Sidebar)
   --------------------------- */

.shell { height: 100vh; background: var(--bg); }

.shell__sidenav {
  width: min(var(--sidebar), 90vw);
  flex: 0 0 min(var(--sidebar), 90vw);
  border-right: 1px solid rgba(255, 255, 255, 0.08);
  background: #000000;
  color: #f5f7fb;
  padding: calc(20px * var(--m)) calc(16px * var(--m));
  display: flex;
  flex-direction: column;
  gap: var(--gap-2);
  box-shadow: inset -1px 0 0 rgba(255, 255, 255, 0.04);
}

.sidenav__wrapper { display: flex; flex-direction: column; gap: var(--gap-2); height: 100%; }

.sidenav__header {
  display: flex;
  align-items: center;
  min-height: calc(32px * var(--m));
  padding-inline: calc(4px * var(--m));
}
.sidenav__brand {
  font-size: clamp(15px, calc(16px * var(--m)), 18px);
  font-weight: 700;
  letter-spacing: 0.16em;
  text-transform: uppercase;
}

.shell__content {
  background: var(--bg);
  color: var(--fg);
  min-width: 0;
  display: flex;
  flex-direction: column;
  height: 100%;
}

/* ---------------------------
   Topbar（ブランドとタブの間隔 & タブをボタン化）
   --------------------------- */
.topbar {
  position: sticky;
  top: 0;
  z-index: 1000;
  display: flex;
  align-items: center;
  gap: clamp(12px, 2vw, 24px);
  height: var(--topbar-h);
  padding-inline: clamp(16px, 4vw, 32px);
  box-shadow: 0 1px 0 rgba(15, 23, 42, 0.08);
}
.mat-toolbar.topbar.mat-primary {
  background: var(--surface);
  color: var(--fg);
}

.topbar .menu-button {
  color: inherit;
}

.brand {
  display: flex;
  align-items: center;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.16em;
  min-width: 0;
  font-size: clamp(14px, calc(15px * var(--m)), 18px);
}
.brand__title { white-space: nowrap; }

.topnav {
  display: flex;
  align-items: center;
  gap: calc(10px * var(--m));
  min-width: 0;
  white-space: nowrap;
  overflow: hidden;
  flex: 1 1 auto;
}

/* タブを“ボタンUI”に */
.topnav .tab-btn {
  border-radius: 999px !important;
  border: 1px solid var(--border) !important;
  padding: 0 clamp(16px, 2vw, 24px) !important;
  height: clamp(30px, calc(32px * var(--m)), 36px) !important;
  min-height: clamp(30px, calc(32px * var(--m)), 36px) !important;
  line-height: 1 !important;
  backdrop-filter: blur(6px);
  transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
}
.topnav .tab-btn:hover {
  background: color-mix(in srgb, var(--accent-blue) 6%, #ffffff 94%);
}
.topnav .tab-btn.active {
  background: color-mix(in srgb, var(--accent-blue) 12%, #ffffff 88%);
  border-color: color-mix(in srgb, var(--accent-blue) 40%, transparent) !important;
  box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--accent-blue) 32%, transparent);
}

.topbar .spacer {
  flex: 0 0 clamp(24px, 6vw, 96px);
}

/* 右上：サインイン／アウト＆ユーザー名を40%縮小 */
.topbar-actions { display: flex; align-items: center; gap: calc(6px * var(--m)); flex-wrap: nowrap; min-width: 0; margin-left: auto; }

.auth-button.auth--compact {
  border-radius: 999px !important;
  font-size: calc(9px * var(--m));
  height: calc(18px * var(--m)) !important;
  min-height: calc(18px * var(--m)) !important;
  padding: 0 calc(6px * var(--m)) !important;
  --mdc-outlined-button-outline-width: 1px;
}
.user-chip.user-chip--compact {
  display: inline-flex; align-items: center;
  height: calc(18px * var(--m)); padding: 0 calc(6px * var(--m));
  border-radius: 999px; background: color-mix(in srgb, var(--accent-blue) 12%, transparent);
  font-size: calc(9px * var(--m)); min-width: 0;
}

/* 残りの既存スタイル（Base / Cards / Utilities / Content area など）は現行を維持 */
.content-area {
  flex: 1 1 auto;
  width: 100%;
  min-width: 0;
  min-height: calc(100vh - var(--topbar-h));
  padding: clamp(16px, 3vw, 28px);
  background: var(--bg);
}

@media (max-width: 959px) {
  .content-area { padding: clamp(12px, 4vw, 20px); }
  .topnav { overflow-x: auto; }
  .topnav .tab-btn { flex: 0 0 auto; }
  .topbar-actions { margin-left: auto; }
}

.shell__sidenav.mat-drawer,
.shell__sidenav.mat-sidenav,
.mat-drawer.shell__sidenav,
.mat-sidenav.shell__sidenav {
  width: var(--sidebar) !important;
  flex: 0 0 var(--sidebar) !important;
}
.shell__sidenav .mat-drawer-inner-container {
  width: 100% !important;
}

/* --- Sidenav 幅とコンテンツの押し出し幅を同期させる --- */
.shell .mat-sidenav-container {
  /* コンテンツ側のオフセット（押し出し幅）を、実際のサイドバー幅と一致させる */
  --mat-sidenav-container-sidenav-width: min(var(--sidebar), 90vw);
}

.shell :where(.mat-sidenav, .mat-drawer) {
  /* 実際のサイドバーの見た目の幅も同じ値に */
  width: min(var(--sidebar), 90vw) !important;
  flex: 0 0 min(var(--sidebar), 90vw) !important;
  box-sizing: border-box;
}

/* 念のため、コンテンツ側のはみ出し・縮み対策 */
.shell :where(.mat-drawer-content, .mat-sidenav-content, .shell__content) {
  min-width: 0;
  overflow-x: hidden;
  overflow-y: auto;
}

.shell :where(.mat-drawer-content, .mat-sidenav-content) > * {
  min-width: 0;
}


/* ===== 以降（列レイアウトやツリー/タスクの既存スタイル）は現行のままでOK ===== */

